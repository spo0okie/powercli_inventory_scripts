# PowerCLI Inventory scripts
Считывает данные с VMware. Добаваляет в БД инвентаризации новые ОС, которые не были созданы скрипами из гостевой операционки. Прикрепляет новые и существующие ОС к АРМу Хоста VMware, на котором они запущены. Те ОС, которые создал ранее и которые не были перезаписаны из гостевой ОС обновляет (IP,железо).  
 * В операционки хостов пишет реальное железо (модель ЦПУ, число ядер, объем RAM) кроме дисковой подсистемы, т.к. там все сложно
 * В операционки виртуалок пишет число ядер и RAM, чтото про диски я забыл. В след версиях будет)
 
для работы требуется наличие конфигурационного файла config.priv.ps1 следующего содержания:
```powershell
#адрес веб АПИ инвентаризации
$inventory_RESTapi_URL="http://10.10.30.65:8081/web/api"
#разрешить запись в инвентаризацию (иначе все изменения будет писать в консоль)
$write_inventory=$true

#учетные данные для vCenter
$VMWare_vcenter='center.domain.local'
$inventory_VMWareUser='DOMAIN\user'
$inventory_VMWarePassword='someSecretPasswd'

#в какой домен определять ОС без домена
$inventory_defaultDomain='WORKGROUP' 

```
### ToDo
 * указание машин для исключения при обходе VMware (девелоп, тестовое окружения)
### History
 * v0.7 Изменен режим обработки ситуации, когда домен VM не удается полчить от гипервизора. Перед подстановкой домена по умолчанию теперь скрипт пытается сначала найти машину в БД по связки имя+ИП адрес, и если не находит, тогда уже подставляет домен по умолчанию.
 * v0.6 Отлажена работа с ядрами. Выгрузка железа переведена на передачу ядер отдельным параметром, добавлена выгрузка дисков
 * v0.5.3 Исправлен поиск VMView для VM (поиск ведется не сравнением строк а через Regexp)
 * v0.5.2 Добавлен поиск количества ядер в сокетах (ранее считалось только количество сокетов)
 * v0.5.1 Добавлена простановка статуса "игнорировать железо" всем виртуалкам
 * v0.5 Добавлено выдергивание хостнейма и домена из настроек сети хоста, если в вцентре он по IP
 * v0.4.2 Добавлен режим readonly, которые блокирует запись в БД инвентаризации (вместо этого данные выводятся в консоль)
 * v0.4.1 Убрано дебажное логирование
 * v0.4 Создает новые ОС, которых нет в БД, но они запущены на гипервизоре, прикручивает их к АРМ хоста. Обновляет данные ОС, которые созданы этим скриптом.
 * v0.3 Перемещает уже существующие в БД OC на АРМы гипервизоров
 * v0.2.1 Исправлен формат ОЗУ (ГБ вместо МБ), исправлен формат IP
 * v0.2 Отправляет IP адреса и время снятия данных
 * v0.1 Отправляет часть данных по хостам: железо, версия ESXi
